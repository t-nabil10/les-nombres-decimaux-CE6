<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfMath - Gestion de Cours</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #2980b9);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 0 0 10px 10px;
            margin-bottom: 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-tabs {
            display: flex;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
        }
        
        .tab:hover:not(.active) {
            background-color: #e9ecef;
        }
        
        .tab-content {
            display: none;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .alert-success {
            background-color: #d1f2eb;
            border: 1px solid #a3e4d7;
            color: #1d8348;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-success {
            background-color: var(--secondary);
            color: white;
        }
        
        .badge-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .badge-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .github-section {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #e1e4e8;
        }
        
        .github-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #24292e;
            margin-bottom: 15px;
        }
        
        .github-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-github {
            background-color: #24292e;
            color: white;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid #e0e0e0;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1><i class="fas fa-chalkboard-teacher"></i> ProfMath - Gestion de Cours</h1>
                <div id="current-date"></div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <div class="tab active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt"></i> Tableau de bord
            </div>
            <div class="tab" data-tab="students">
                <i class="fas fa-users"></i> Élèves
            </div>
            <div class="tab" data-tab="sessions">
                <i class="fas fa-calendar-alt"></i> Séances
            </div>
            <div class="tab" data-tab="finances">
                <i class="fas fa-euro-sign"></i> Finances
            </div>
            <div class="tab" data-tab="backup">
                <i class="fas fa-cloud-upload-alt"></i> Sauvegarde
            </div>
        </div>

        <!-- Tableau de bord -->
        <div id="dashboard" class="tab-content active">
            <h2>Tableau de bord</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-value" id="total-students">0</div>
                    <div class="stat-label">Élèves actifs</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-value" id="total-sessions">0</div>
                    <div class="stat-label">Séances ce mois</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-euro-sign"></i>
                    <div class="stat-value" id="total-revenue">0€</div>
                    <div class="stat-label">Revenus ce mois</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <div class="stat-value" id="pending-payments">0€</div>
                    <div class="stat-label">Paiements en attente</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-exclamation-triangle"></i> Alertes importantes</h3>
                <div id="alerts-container">
                    <!-- Les alertes seront ajoutées ici dynamiquement -->
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-history"></i> Séances récentes</h3>
                <div id="recent-sessions">
                    <!-- Les séances récentes seront ajoutées ici -->
                </div>
            </div>
        </div>

        <!-- Gestion des élèves -->
        <div id="students" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-user-plus"></i> Ajouter un élève</h3>
                <form id="add-student-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-name">Nom complet</label>
                            <input type="text" id="student-name" required>
                        </div>
                        <div class="form-group">
                            <label for="student-email">Email</label>
                            <input type="email" id="student-email">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="student-phone">Téléphone</label>
                            <input type="tel" id="student-phone">
                        </div>
                        <div class="form-group">
                            <label for="student-rate">Tarif horaire (€)</label>
                            <input type="number" id="student-rate" min="0" step="0.5" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="student-notes">Notes</label>
                        <textarea id="student-notes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Enregistrer l'élève
                    </button>
                </form>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> Liste des élèves</h3>
                <div id="students-list">
                    <!-- La liste des élèves sera ajoutée ici dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Gestion des séances -->
        <div id="sessions" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-plus-circle"></i> Planifier une séance</h3>
                <form id="add-session-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="session-student">Élève</label>
                            <select id="session-student" required>
                                <option value="">Sélectionner un élève</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="session-date">Date</label>
                            <input type="date" id="session-date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="session-duration">Durée (heures)</label>
                            <input type="number" id="session-duration" min="0.5" step="0.5" required>
                        </div>
                        <div class="form-group">
                            <label for="session-paid">Statut paiement</label>
                            <select id="session-paid">
                                <option value="paid">Payé</option>
                                <option value="pending" selected>En attente</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="session-notes">Notes sur la séance</label>
                        <textarea id="session-notes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calendar-plus"></i> Ajouter la séance
                    </button>
                </form>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-history"></i> Historique des séances</h3>
                <div id="sessions-list">
                    <!-- La liste des séances sera ajoutée ici dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Finances -->
        <div id="finances" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-chart-line"></i> Revenus et statistiques</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-euro-sign"></i>
                        <div class="stat-value" id="month-revenue">0€</div>
                        <div class="stat-label">Ce mois</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar"></i>
                        <div class="stat-value" id="year-revenue">0€</div>
                        <div class="stat-label">Cette année</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-value" id="total-pending">0€</div>
                        <div class="stat-label">En attente</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <div class="stat-value" id="total-received">0€</div>
                        <div class="stat-label">Reçus</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-list"></i> Détails des paiements</h3>
                <div id="payments-list">
                    <!-- La liste des paiements sera ajoutée ici dynamiquement -->
                </div>
            </div>
        </div>

        <!-- Sauvegarde GitHub -->
        <div id="backup" class="tab-content">
            <div class="card">
                <h3><i class="fas fa-database"></i> Gestion des données</h3>
                <p>Exportez vos données pour les sauvegarder ou les importer sur un autre appareil.</p>
                
                <div class="github-actions">
                    <button id="export-data" class="btn btn-primary">
                        <i class="fas fa-download"></i> Exporter les données
                    </button>
                    <button id="import-data" class="btn btn-secondary">
                        <i class="fas fa-upload"></i> Importer des données
                    </button>
                    <button id="clear-data" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Effacer toutes les données
                    </button>
                </div>
                
                <input type="file" id="import-file" style="display: none;" accept=".json">
            </div>
            
            <div class="github-section">
                <h3><i class="fab fa-github"></i> Sauvegarde GitHub</h3>
                <p>Pour une sauvegarde sécurisée, créez un dépôt GitHub privé et suivez ces étapes :</p>
                
                <ol style="margin: 15px 0; padding-left: 20px;">
                    <li>Créez un compte sur <a href="https://github.com" target="_blank">GitHub</a></li>
                    <li>Créez un nouveau dépôt privé nommé "profmath-data"</li>
                    <li>Exportez vos données avec le bouton ci-dessus</li>
                    <li>Ajoutez le fichier JSON à votre dépôt GitHub</li>
                    <li>Répétez régulièrement pour garder une sauvegarde à jour</li>
                </ol>
                
                <p><strong>Avantage :</strong> Vos données sont sauvegardées en ligne et accessibles depuis n'importe quel appareil.</p>
            </div>
        </div>

        <footer>
            <p>ProfMath - Application de gestion de cours particuliers © 2023</p>
        </footer>
    </div>

    <!-- Modal pour détails élève -->
    <div id="student-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Détails de l'élève</h3>
                <span class="close">&times;</span>
            </div>
            <div id="student-modal-content">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>

    <script>
        // Données de l'application
        let students = JSON.parse(localStorage.getItem('profmath-students')) || [];
        let sessions = JSON.parse(localStorage.getItem('profmath-sessions')) || [];

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Afficher la date actuelle
            const now = new Date();
            document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Initialiser les onglets
            initTabs();
            
            // Initialiser les formulaires
            initForms();
            
            // Charger les données
            refreshDashboard();
            refreshStudents();
            refreshSessions();
            refreshFinances();
            
            // Initialiser les événements de sauvegarde
            initBackup();
        });

        // Gestion des onglets
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Désactiver tous les onglets
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // Activer l'onglet sélectionné
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Recharger les données si nécessaire
                    if (tabId === 'students') refreshStudents();
                    if (tabId === 'sessions') refreshSessions();
                    if (tabId === 'finances') refreshFinances();
                });
            });
        }

        // Initialisation des formulaires
        function initForms() {
            // Formulaire d'ajout d'élève
            document.getElementById('add-student-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const student = {
                    id: Date.now(),
                    name: document.getElementById('student-name').value,
                    email: document.getElementById('student-email').value,
                    phone: document.getElementById('student-phone').value,
                    rate: parseFloat(document.getElementById('student-rate').value),
                    notes: document.getElementById('student-notes').value,
                    active: true,
                    createdAt: new Date().toISOString()
                };
                
                students.push(student);
                saveData();
                refreshStudents();
                refreshDashboard();
                
                // Réinitialiser le formulaire
                this.reset();
                
                // Afficher un message de succès
                alert('Élève ajouté avec succès!');
            });
            
            // Formulaire d'ajout de séance
            document.getElementById('add-session-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const session = {
                    id: Date.now(),
                    studentId: parseInt(document.getElementById('session-student').value),
                    date: document.getElementById('session-date').value,
                    duration: parseFloat(document.getElementById('session-duration').value),
                    paid: document.getElementById('session-paid').value,
                    notes: document.getElementById('session-notes').value,
                    createdAt: new Date().toISOString()
                };
                
                sessions.push(session);
                saveData();
                refreshSessions();
                refreshDashboard();
                refreshFinances();
                
                // Réinitialiser le formulaire
                this.reset();
                
                // Afficher un message de succès
                alert('Séance ajoutée avec succès!');
            });
        }

        // Rafraîchir le tableau de bord
        function refreshDashboard() {
            // Calculer les statistiques
            const totalStudents = students.filter(s => s.active).length;
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear;
            });
            
            const totalMonthSessions = monthSessions.length;
            
            let totalMonthRevenue = 0;
            monthSessions.forEach(session => {
                if (session.paid === 'paid') {
                    const student = students.find(st => st.id === session.studentId);
                    if (student) {
                        totalMonthRevenue += student.rate * session.duration;
                    }
                }
            });
            
            let pendingPayments = 0;
            const pendingSessions = sessions.filter(s => s.paid === 'pending');
            pendingSessions.forEach(session => {
                const student = students.find(st => st.id === session.studentId);
                if (student) {
                    pendingPayments += student.rate * session.duration;
                }
            });
            
            // Mettre à jour l'interface
            document.getElementById('total-students').textContent = totalStudents;
            document.getElementById('total-sessions').textContent = totalMonthSessions;
            document.getElementById('total-revenue').textContent = totalMonthRevenue.toFixed(2) + '€';
            document.getElementById('pending-payments').textContent = pendingPayments.toFixed(2) + '€';
            
            // Mettre à jour les alertes
            const alertsContainer = document.getElementById('alerts-container');
            alertsContainer.innerHTML = '';
            
            if (pendingSessions.length > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `<i class="fas fa-exclamation-circle"></i> Vous avez ${pendingSessions.length} séance(s) en attente de paiement (${pendingPayments.toFixed(2)}€)`;
                alertsContainer.appendChild(alert);
            }
            
            // Mettre à jour les séances récentes
            const recentSessionsContainer = document.getElementById('recent-sessions');
            recentSessionsContainer.innerHTML = '';
            
            const recentSessions = sessions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentSessions.length === 0) {
                recentSessionsContainer.innerHTML = '<p>Aucune séance récente.</p>';
            } else {
                const table = document.createElement('table');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Élève</th>
                            <th>Durée</th>
                            <th>Statut</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recentSessions.map(session => {
                            const student = students.find(s => s.id === session.studentId);
                            const studentName = student ? student.name : 'Inconnu';
                            const statusBadge = session.paid === 'paid' ? 
                                '<span class="badge badge-success">Payé</span>' : 
                                '<span class="badge badge-warning">En attente</span>';
                            
                            return `
                                <tr>
                                    <td>${new Date(session.date).toLocaleDateString('fr-FR')}</td>
                                    <td>${studentName}</td>
                                    <td>${session.duration}h</td>
                                    <td>${statusBadge}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                `;
                recentSessionsContainer.appendChild(table);
            }
        }

        // Rafraîchir la liste des élèves
        function refreshStudents() {
            // Mettre à jour la liste déroulante des élèves pour les séances
            const studentSelect = document.getElementById('session-student');
            studentSelect.innerHTML = '<option value="">Sélectionner un élève</option>';
            
            students.filter(s => s.active).forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                studentSelect.appendChild(option);
            });
            
            // Mettre à jour la liste des élèves
            const studentsList = document.getElementById('students-list');
            studentsList.innerHTML = '';
            
            if (students.length === 0) {
                studentsList.innerHTML = '<p>Aucun élève enregistré.</p>';
                return;
            }
            
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Contact</th>
                        <th>Tarif/h</th>
                        <th>Séances</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${students.map(student => {
                        const studentSessions = sessions.filter(s => s.studentId === student.id);
                        const paidSessions = studentSessions.filter(s => s.paid === 'paid');
                        const pendingSessions = studentSessions.filter(s => s.paid === 'pending');
                        
                        return `
                            <tr>
                                <td>${student.name}</td>
                                <td>
                                    ${student.email ? student.email + '<br>' : ''}
                                    ${student.phone || ''}
                                </td>
                                <td>${student.rate}€</td>
                                <td>
                                    ${paidSessions.length} payée(s)<br>
                                    ${pendingSessions.length} en attente
                                </td>
                                <td>
                                    <button class="btn btn-primary view-student" data-id="${student.id}">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-danger delete-student" data-id="${student.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
            studentsList.appendChild(table);
            
            // Ajouter les événements pour les boutons
            document.querySelectorAll('.view-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    showStudentDetails(studentId);
                });
            });
            
            document.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const studentId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Êtes-vous sûr de vouloir supprimer cet élève ?')) {
                        deleteStudent(studentId);
                    }
                });
            });
        }

        // Rafraîchir la liste des séances
        function refreshSessions() {
            const sessionsList = document.getElementById('sessions-list');
            sessionsList.innerHTML = '';
            
            if (sessions.length === 0) {
                sessionsList.innerHTML = '<p>Aucune séance enregistrée.</p>';
                return;
            }
            
            const sortedSessions = sessions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Élève</th>
                        <th>Durée</th>
                        <th>Montant</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${sortedSessions.map(session => {
                        const student = students.find(s => s.id === session.studentId);
                        const studentName = student ? student.name : 'Inconnu';
                        const amount = student ? (student.rate * session.duration).toFixed(2) + '€' : 'N/A';
                        const statusBadge = session.paid === 'paid' ? 
                            '<span class="badge badge-success">Payé</span>' : 
                            '<span class="badge badge-warning">En attente</span>';
                        
                        return `
                            <tr>
                                <td>${new Date(session.date).toLocaleDateString('fr-FR')}</td>
                                <td>${studentName}</td>
                                <td>${session.duration}h</td>
                                <td>${amount}</td>
                                <td>${statusBadge}</td>
                                <td>
                                    <button class="btn btn-secondary toggle-payment" data-id="${session.id}">
                                        <i class="fas fa-exchange-alt"></i>
                                    </button>
                                    <button class="btn btn-danger delete-session" data-id="${session.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
            sessionsList.appendChild(table);
            
            // Ajouter les événements pour les boutons
            document.querySelectorAll('.toggle-payment').forEach(button => {
                button.addEventListener('click', function() {
                    const sessionId = parseInt(this.getAttribute('data-id'));
                    togglePaymentStatus(sessionId);
                });
            });
            
            document.querySelectorAll('.delete-session').forEach(button => {
                button.addEventListener('click', function() {
                    const sessionId = parseInt(this.getAttribute('data-id'));
                    if (confirm('Êtes-vous sûr de vouloir supprimer cette séance ?')) {
                        deleteSession(sessionId);
                    }
                });
            });
        }

        // Rafraîchir les finances
        function refreshFinances() {
            // Calculer les revenus
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear;
            });
            
            const yearSessions = sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate.getFullYear() === currentYear;
            });
            
            let monthRevenue = 0;
            monthSessions.forEach(session => {
                if (session.paid === 'paid') {
                    const student = students.find(st => st.id === session.studentId);
                    if (student) {
                        monthRevenue += student.rate * session.duration;
                    }
                }
            });
            
            let yearRevenue = 0;
            yearSessions.forEach(session => {
                if (session.paid === 'paid') {
                    const student = students.find(st => st.id === session.studentId);
                    if (student) {
                        yearRevenue += student.rate * session.duration;
                    }
                }
            });
            
            let totalPending = 0;
            let totalReceived = 0;
            
            sessions.forEach(session => {
                const student = students.find(st => st.id === session.studentId);
                if (student) {
                    const amount = student.rate * session.duration;
                    if (session.paid === 'paid') {
                        totalReceived += amount;
                    } else {
                        totalPending += amount;
                    }
                }
            });
            
            // Mettre à jour l'interface
            document.getElementById('month-revenue').textContent = monthRevenue.toFixed(2) + '€';
            document.getElementById('year-revenue').textContent = yearRevenue.toFixed(2) + '€';
            document.getElementById('total-pending').textContent = totalPending.toFixed(2) + '€';
            document.getElementById('total-received').textContent = totalReceived.toFixed(2) + '€';
            
            // Mettre à jour la liste des paiements
            const paymentsList = document.getElementById('payments-list');
            paymentsList.innerHTML = '';
            
            if (sessions.length === 0) {
                paymentsList.innerHTML = '<p>Aucun paiement enregistré.</p>';
                return;
            }
            
            const table = document.createElement('table');
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Élève</th>
                        <th>Durée</th>
                        <th>Tarif/h</th>
                        <th>Montant</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    ${sessions.map(session => {
                        const student = students.find(s => s.id === session.studentId);
                        const studentName = student ? student.name : 'Inconnu';
                        const studentRate = student ? student.rate + '€' : 'N/A';
                        const amount = student ? (student.rate * session.duration).toFixed(2) + '€' : 'N/A';
                        const statusBadge = session.paid === 'paid' ? 
                            '<span class="badge badge-success">Payé</span>' : 
                            '<span class="badge badge-warning">En attente</span>';
                        
                        return `
                            <tr>
                                <td>${new Date(session.date).toLocaleDateString('fr-FR')}</td>
                                <td>${studentName}</td>
                                <td>${session.duration}h</td>
                                <td>${studentRate}</td>
                                <td>${amount}</td>
                                <td>${statusBadge}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            `;
            paymentsList.appendChild(table);
        }

        // Afficher les détails d'un élève
        function showStudentDetails(studentId) {
            const student = students.find(s => s.id === studentId);
            if (!student) return;
            
            const studentSessions = sessions.filter(s => s.studentId === studentId);
            const paidSessions = studentSessions.filter(s => s.paid === 'paid');
            const pendingSessions = studentSessions.filter(s => s.paid === 'pending');
            
            let totalPaid = 0;
            paidSessions.forEach(session => {
                totalPaid += student.rate * session.duration;
            });
            
            let totalPending = 0;
            pendingSessions.forEach(session => {
                totalPending += student.rate * session.duration;
            });
            
            const modalContent = document.getElementById('student-modal-content');
            modalContent.innerHTML = `
                <h4>${student.name}</h4>
                <p><strong>Email:</strong> ${student.email || 'Non renseigné'}</p>
                <p><strong>Téléphone:</strong> ${student.phone || 'Non renseigné'}</p>
                <p><strong>Tarif horaire:</strong> ${student.rate}€</p>
                <p><strong>Notes:</strong> ${student.notes || 'Aucune note'}</p>
                
                <h5 style="margin-top: 20px;">Statistiques</h5>
                <ul>
                    <li>Total séances: ${studentSessions.length}</li>
                    <li>Séances payées: ${paidSessions.length} (${totalPaid.toFixed(2)}€)</li>
                    <li>Séances en attente: ${pendingSessions.length} (${totalPending.toFixed(2)}€)</li>
                </ul>
                
                <h5 style="margin-top: 20px;">Dernières séances</h5>
                <ul>
                    ${studentSessions
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5)
                        .map(session => `
                            <li>${new Date(session.date).toLocaleDateString('fr-FR')} - ${session.duration}h - 
                            ${session.paid === 'paid' ? 'Payé' : 'En attente'}</li>
                        `).join('')}
                </ul>
            `;
            
            const modal = document.getElementById('student-modal');
            modal.style.display = 'flex';
            
            // Fermer la modal
            document.querySelector('.close').addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Basculer le statut de paiement d'une séance
        function togglePaymentStatus(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (session) {
                session.paid = session.paid === 'paid' ? 'pending' : 'paid';
                saveData();
                refreshSessions();
                refreshDashboard();
                refreshFinances();
            }
        }

        // Supprimer un élève
        function deleteStudent(studentId) {
            students = students.filter(s => s.id !== studentId);
            // Supprimer aussi les séances associées
            sessions = sessions.filter(s => s.studentId !== studentId);
            saveData();
            refreshStudents();
            refreshDashboard();
            refreshSessions();
            refreshFinances();
        }

        // Supprimer une séance
        function deleteSession(sessionId) {
            sessions = sessions.filter(s => s.id !== sessionId);
            saveData();
            refreshSessions();
            refreshDashboard();
            refreshFinances();
        }

        // Sauvegarder les données
        function saveData() {
            localStorage.setItem('profmath-students', JSON.stringify(students));
            localStorage.setItem('profmath-sessions', JSON.stringify(sessions));
        }

        // Initialiser la sauvegarde
        function initBackup() {
            // Exporter les données
            document.getElementById('export-data').addEventListener('click', function() {
                const data = {
                    students: students,
                    sessions: sessions,
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `profmath-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            });
            
            // Importer les données
            document.getElementById('import-data').addEventListener('click', function() {
                document.getElementById('import-file').click();
            });
            
            document.getElementById('import-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.students && data.sessions) {
                            if (confirm('Voulez-vous remplacer toutes vos données actuelles par celles du fichier ?')) {
                                students = data.students;
                                sessions = data.sessions;
                                saveData();
                                refreshDashboard();
                                refreshStudents();
                                refreshSessions();
                                refreshFinances();
                                alert('Données importées avec succès!');
                            }
                        } else {
                            alert('Le fichier sélectionné n\'est pas valide.');
                        }
                    } catch (error) {
                        alert('Erreur lors de l\'importation: ' + error.message);
                    }
                };
                reader.readAsText(file);
                
                // Réinitialiser l'input
                this.value = '';
            });
            
            // Effacer toutes les données
            document.getElementById('clear-data').addEventListener('click', function() {
                if (confirm('Êtes-vous sûr de vouloir effacer TOUTES vos données ? Cette action est irréversible.')) {
                    students = [];
                    sessions = [];
                    saveData();
                    refreshDashboard();
                    refreshStudents();
                    refreshSessions();
                    refreshFinances();
                    alert('Toutes les données ont été effacées.');
                }
            });
        }
    </script>
</body>
</html>
